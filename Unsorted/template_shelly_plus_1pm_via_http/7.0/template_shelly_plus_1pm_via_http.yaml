zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: a086b5c471b648ed844efc1d04c2a66d
      name: Templates/IOT
  templates:
    - uuid: f2c92f97ba5c403b9e7ee5cb1d32cf8a
      template: 'Shelly Plus 1PM'
      name: 'Shelly Plus 1PM'
      description: |
        Monitor Shelly Plus 1PM Gen2 smart switch with power monitoring.
        
        This template monitors the Shelly Plus 1PM device via HTTP using the Gen2 RPC API.
        No additional software installation required - the template uses HTTP agent items.
        
        Requirements:
        - Shelly Plus 1PM Gen2 device
        - HTTP access to the device
        - Valid credentials if authentication is enabled
        
        Template Author: Community Template
      vendor:
        name: Allterco Robotics
        version: 7.0.0
      groups:
        - name: Templates/IOT
      items:
        - uuid: 6b35a5790f0f40d483e1099edc8f1c81
          name: 'Status gatherer'
          type: HTTP_AGENT
          key: shellyplus1pm.status
          delay: 1m
          description: 'This gatherer gathers all the data for the different items from the RPC API of the Shelly Plus 1PM device.'
          timeout: 15s
          url: 'http://{HOST.CONN}/rpc/Shelly.GetStatus'
          query_fields:
            - name: Content-Type
              value: application/json
          headers:
            - name: User-Agent
              value: Zabbix
          follow_redirects: 'YES'
          retrieve_mode: BODY
          request_method: GET
          allow_traps: 'NO'
          username: '{$SHELLYPWD_USER}'
          password: '{$SHELLYPWD}'
          authtype: DIGEST
          tags:
            - tag: component
              value: raw
        - uuid: 7c35a5790f0f40d483e1099edc8f1c82
          name: 'BLE enabled'
          type: DEPENDENT
          key: shellyplus1pm.status.ble.enable
          delay: '0'
          description: 'Bluetooth Low Energy status'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.ble.enable
              error_handler: ZABBIX_DEFAULT
              error_handler_params: 'false'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: ble
        - uuid: 8c35a5790f0f40d483e1099edc8f1c83
          name: 'Cloud connection state'
          type: DEPENDENT
          key: shellyplus1pm.status.cloud.connected
          delay: '0'
          description: 'Current state of cloud connection'
          valuemap:
            name: 'Boolean (false/true)'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.cloud.connected
              error_handler: ZABBIX_DEFAULT
              error_handler_params: 'false'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: cloud
          triggers:
            - uuid: 9d35a5790f0f40d483e1099edc8f1c84
              expression: 'change(/Shelly Plus 1PM/shellyplus1pm.status.cloud.connected)<>0'
              name: 'Shelly Plus 1PM: Cloud connection state has changed'
              event_name: 'Shelly Plus 1PM: Cloud connection state has changed'
              priority: WARNING
              manual_close: 'YES'
        - uuid: ac35a5790f0f40d483e1099edc8f1c85
          name: 'Input state'
          type: DEPENDENT
          key: shellyplus1pm.status.input0.state
          delay: '0'
          description: 'Current state of input 0'
          valuemap:
            name: 'Boolean (false/true)'
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.["input:0"].state'
              error_handler: ZABBIX_DEFAULT
              error_handler_params: 'false'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: input
          triggers:
            - uuid: bd35a5790f0f40d483e1099edc8f1c86
              expression: 'change(/Shelly Plus 1PM/shellyplus1pm.status.input0.state)<>0'
              name: 'Shelly Plus 1PM: Input state has changed'
              event_name: 'Shelly Plus 1PM: Input state has changed'
              priority: INFO
              manual_close: 'YES'
        - uuid: cd35a5790f0f40d483e1099edc8f1c87
          name: 'MQTT connection state'
          type: DEPENDENT
          key: shellyplus1pm.status.mqtt.connected
          delay: '0'
          description: 'Current state of MQTT connection'
          valuemap:
            name: 'Boolean (false/true)'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.mqtt.connected
              error_handler: ZABBIX_DEFAULT
              error_handler_params: 'false'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: mqtt
          triggers:
            - uuid: dd35a5790f0f40d483e1099edc8f1c88
              expression: 'change(/Shelly Plus 1PM/shellyplus1pm.status.mqtt.connected)<>0'
              name: 'Shelly Plus 1PM: MQTT connection state has changed'
              event_name: 'Shelly Plus 1PM: MQTT connection state has changed'
              priority: WARNING
              manual_close: 'YES'
        - uuid: ed35a5790f0f40d483e1099edc8f1c89
          name: 'Switch output state'
          type: DEPENDENT
          key: shellyplus1pm.status.switch0.output
          delay: '0'
          description: 'Current output state of switch 0'
          valuemap:
            name: 'Boolean (false/true)'
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.["switch:0"].output'
              error_handler: ZABBIX_DEFAULT
              error_handler_params: 'false'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: switch
          triggers:
            - uuid: fd35a5790f0f40d483e1099edc8f1c8a
              expression: 'change(/Shelly Plus 1PM/shellyplus1pm.status.switch0.output)<>0'
              name: 'Shelly Plus 1PM: Switch state has changed'
              event_name: 'Shelly Plus 1PM: Switch state has changed'
              priority: WARNING
              manual_close: 'YES'
        - uuid: 0e35a5790f0f40d483e1099edc8f1c8b
          name: 'Switch command source'
          type: DEPENDENT
          key: shellyplus1pm.status.switch0.source
          delay: '0'
          description: 'Last source of switch command'
          value_type: TEXT
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.["switch:0"].source'
              error_handler: ZABBIX_DEFAULT
              error_handler_params: 'init'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: switch
        - uuid: 1f35a5790f0f40d483e1099edc8f1c8c
          name: 'Current power consumption'
          type: DEPENDENT
          key: shellyplus1pm.status.switch0.apower
          delay: '0'
          description: 'Active power being consumed (Watts)'
          value_type: FLOAT
          units: W
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.["switch:0"].apower'
              error_handler: ZABBIX_DEFAULT
              error_handler_params: '0'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: power
        - uuid: 2035a5790f0f40d483e1099edc8f1c8d
          name: 'Current voltage'
          type: DEPENDENT
          key: shellyplus1pm.status.switch0.voltage
          delay: '0'
          description: 'AC voltage (Volts)'
          value_type: FLOAT
          units: V
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.["switch:0"].voltage'
              error_handler: ZABBIX_DEFAULT
              error_handler_params: '0'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: power
        - uuid: 3135a5790f0f40d483e1099edc8f1c8e
          name: 'Current amperage'
          type: DEPENDENT
          key: shellyplus1pm.status.switch0.current
          delay: '0'
          description: 'Current being drawn (Amperes)'
          value_type: FLOAT
          units: A
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.["switch:0"].current'
              error_handler: ZABBIX_DEFAULT
              error_handler_params: '0'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: power
        - uuid: 4235a5790f0f40d483e1099edc8f1c8f
          name: 'Total energy consumed'
          type: DEPENDENT
          key: shellyplus1pm.status.switch0.aenergy.total
          delay: '0'
          description: 'Total energy consumed (Watt-hours)'
          value_type: FLOAT
          units: Wh
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.["switch:0"].aenergy.total'
              error_handler: ZABBIX_DEFAULT
              error_handler_params: '0'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: energy
        - uuid: 5335a5790f0f40d483e1099edc8f1c90
          name: 'Energy consumption (1 min avg)'
          type: DEPENDENT
          key: shellyplus1pm.status.switch0.aenergy.by_minute.0
          delay: '0'
          description: 'Energy consumption for current minute (Watt-minutes)'
          value_type: FLOAT
          units: Wmin
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.["switch:0"].aenergy.by_minute[0]'
              error_handler: ZABBIX_DEFAULT
              error_handler_params: '0'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: energy
        - uuid: 6435a5790f0f40d483e1099edc8f1c91
          name: 'Energy consumption (2 min avg)'
          type: DEPENDENT
          key: shellyplus1pm.status.switch0.aenergy.by_minute.1
          delay: '0'
          description: 'Energy consumption for previous minute (Watt-minutes)'
          value_type: FLOAT
          units: Wmin
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.["switch:0"].aenergy.by_minute[1]'
              error_handler: ZABBIX_DEFAULT
              error_handler_params: '0'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: energy
        - uuid: 7535a5790f0f40d483e1099edc8f1c92
          name: 'Energy consumption (3 min avg)'
          type: DEPENDENT
          key: shellyplus1pm.status.switch0.aenergy.by_minute.2
          delay: '0'
          description: 'Energy consumption for two minutes ago (Watt-minutes)'
          value_type: FLOAT
          units: Wmin
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.["switch:0"].aenergy.by_minute[2]'
              error_handler: ZABBIX_DEFAULT
              error_handler_params: '0'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: energy
        - uuid: 8635a5790f0f40d483e1099edc8f1c93
          name: 'Energy timestamp'
          type: DEPENDENT
          key: shellyplus1pm.status.switch0.aenergy.minute_ts
          delay: '0'
          description: 'Unix timestamp of the last energy counter update'
          value_type: FLOAT
          units: unixtime
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.["switch:0"].aenergy.minute_ts'
              error_handler: ZABBIX_DEFAULT
              error_handler_params: '0'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: energy
        - uuid: 9735a5790f0f40d483e1099edc8f1c94
          name: 'Device temperature (°C)'
          type: DEPENDENT
          key: shellyplus1pm.status.switch0.temperature.tC
          delay: '0'
          description: 'Internal device temperature in Celsius'
          value_type: FLOAT
          units: °C
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.["switch:0"].temperature.tC'
              error_handler: ZABBIX_DEFAULT
              error_handler_params: '0'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: temperature
          triggers:
            - uuid: a835a5790f0f40d483e1099edc8f1c95
              expression: 'last(/Shelly Plus 1PM/shellyplus1pm.status.switch0.temperature.tC)>70'
              name: 'Shelly Plus 1PM: Device temperature is high'
              event_name: 'Shelly Plus 1PM: Device temperature is high ({ITEM.LASTVALUE}°C)'
              priority: AVERAGE
            - uuid: b935a5790f0f40d483e1099edc8f1c96
              expression: 'last(/Shelly Plus 1PM/shellyplus1pm.status.switch0.temperature.tC)>85'
              name: 'Shelly Plus 1PM: Device temperature is very high'
              event_name: 'Shelly Plus 1PM: Device temperature is very high ({ITEM.LASTVALUE}°C)'
              priority: HIGH
        - uuid: ca35a5790f0f40d483e1099edc8f1c97
          name: 'Device temperature (°F)'
          type: DEPENDENT
          key: shellyplus1pm.status.switch0.temperature.tF
          delay: '0'
          description: 'Internal device temperature in Fahrenheit'
          value_type: FLOAT
          units: °F
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.["switch:0"].temperature.tF'
              error_handler: ZABBIX_DEFAULT
              error_handler_params: '32'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: temperature
        - uuid: db35a5790f0f40d483e1099edc8f1c98
          name: 'MAC address'
          type: DEPENDENT
          key: shellyplus1pm.status.sys.mac
          delay: '0'
          description: 'Device MAC address'
          value_type: TEXT
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.sys.mac
              error_handler: ZABBIX_DEFAULT
              error_handler_params: 'Unknown'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: system
        - uuid: ec35a5790f0f40d483e1099edc8f1c99
          name: 'Restart required'
          type: DEPENDENT
          key: shellyplus1pm.status.sys.restart_required
          delay: '0'
          description: 'Whether a restart is required'
          valuemap:
            name: 'Boolean (false/true)'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.sys.restart_required
              error_handler: ZABBIX_DEFAULT
              error_handler_params: 'false'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: fd35a5790f0f40d483e1099edc8f1c9a
              expression: 'last(/Shelly Plus 1PM/shellyplus1pm.status.sys.restart_required)=1'
              name: 'Shelly Plus 1PM: Device requires restart'
              event_name: 'Shelly Plus 1PM: Device requires restart'
              priority: WARNING
        - uuid: 0e35a5790f0f40d483e1099edc8f1c9b
          name: 'Current time'
          type: DEPENDENT
          key: shellyplus1pm.status.sys.time
          delay: '0'
          description: 'Current device time'
          value_type: TEXT
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.sys.time
              error_handler: ZABBIX_DEFAULT
              error_handler_params: 'Unknown'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: system
        - uuid: 1f35a5790f0f40d483e1099edc8f1c9c
          name: 'Unix timestamp'
          type: DEPENDENT
          key: shellyplus1pm.status.sys.unixtime
          delay: '0'
          description: 'Current Unix timestamp'
          value_type: FLOAT
          units: unixtime
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.sys.unixtime
              error_handler: ZABBIX_DEFAULT
              error_handler_params: '0'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: 2035a5790f0f40d483e1099edc8f1c9d
              expression: 'fuzzytime(/Shelly Plus 1PM/shellyplus1pm.status.sys.unixtime,60s)=0'
              name: 'Shelly Plus 1PM: Time is out of sync'
              event_name: 'Shelly Plus 1PM: Time is out of sync'
              priority: WARNING
        - uuid: 3135a5790f0f40d483e1099edc8f1c9e
          name: 'Uptime'
          type: DEPENDENT
          key: shellyplus1pm.status.sys.uptime
          delay: '0'
          description: 'Device uptime in seconds'
          value_type: FLOAT
          units: uptime
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.sys.uptime
              error_handler: ZABBIX_DEFAULT
              error_handler_params: '0'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: 4235a5790f0f40d483e1099edc8f1c9f
              expression: 'last(/Shelly Plus 1PM/shellyplus1pm.status.sys.uptime)<600'
              name: 'Shelly Plus 1PM: Device has been restarted (Uptime <10m)'
              event_name: 'Shelly Plus 1PM: Device has been restarted (Uptime <10m)'
              priority: WARNING
        - uuid: 5335a5790f0f40d483e1099edc8f1ca0
          name: 'RAM size'
          type: DEPENDENT
          key: shellyplus1pm.status.sys.ram_size
          delay: '0'
          description: 'Total RAM size in bytes'
          value_type: FLOAT
          units: B
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.sys.ram_size
              error_handler: ZABBIX_DEFAULT
              error_handler_params: '0'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: memory
        - uuid: 6435a5790f0f40d483e1099edc8f1ca1
          name: 'RAM free'
          type: DEPENDENT
          key: shellyplus1pm.status.sys.ram_free
          delay: '0'
          description: 'Free RAM in bytes'
          value_type: FLOAT
          units: B
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.sys.ram_free
              error_handler: ZABBIX_DEFAULT
              error_handler_params: '0'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: memory
        - uuid: 7535a5790f0f40d483e1099edc8f1ca2
          name: 'Filesystem size'
          type: DEPENDENT
          key: shellyplus1pm.status.sys.fs_size
          delay: '0'
          description: 'Total filesystem size in bytes'
          value_type: FLOAT
          units: B
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.sys.fs_size
              error_handler: ZABBIX_DEFAULT
              error_handler_params: '0'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: filesystem
        - uuid: 8635a5790f0f40d483e1099edc8f1ca3
          name: 'Filesystem free'
          type: DEPENDENT
          key: shellyplus1pm.status.sys.fs_free
          delay: '0'
          description: 'Free filesystem space in bytes'
          value_type: FLOAT
          units: B
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.sys.fs_free
              error_handler: ZABBIX_DEFAULT
              error_handler_params: '0'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: filesystem
          triggers:
            - uuid: 9735a5790f0f40d483e1099edc8f1ca4
              expression: '(last(/Shelly Plus 1PM/shellyplus1pm.status.sys.fs_free)/last(/Shelly Plus 1PM/shellyplus1pm.status.sys.fs_size))<0.2'
              name: 'Shelly Plus 1PM: Filesystem usage >=80%'
              event_name: 'Shelly Plus 1PM: Filesystem usage >=80%'
              priority: WARNING
            - uuid: a835a5790f0f40d483e1099edc8f1ca5
              expression: '(last(/Shelly Plus 1PM/shellyplus1pm.status.sys.fs_free)/last(/Shelly Plus 1PM/shellyplus1pm.status.sys.fs_size))<0.1'
              name: 'Shelly Plus 1PM: Filesystem usage >=90%'
              event_name: 'Shelly Plus 1PM: Filesystem usage >=90%'
              priority: AVERAGE
        - uuid: b935a5790f0f40d483e1099edc8f1ca6
          name: 'WiFi IP address'
          type: DEPENDENT
          key: shellyplus1pm.status.wifi.sta_ip
          delay: '0'
          description: 'Current WiFi IP address'
          value_type: TEXT
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.wifi.sta_ip
              error_handler: ZABBIX_DEFAULT
              error_handler_params: 'Unknown'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: wifi
        - uuid: ca35a5790f0f40d483e1099edc8f1ca7
          name: 'WiFi status'
          type: DEPENDENT
          key: shellyplus1pm.status.wifi.status
          delay: '0'
          description: 'Current WiFi connection status'
          value_type: TEXT
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.wifi.status
              error_handler: ZABBIX_DEFAULT
              error_handler_params: 'Unknown'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: wifi
          triggers:
            - uuid: db35a5790f0f40d483e1099edc8f1ca8
              expression: 'find(/Shelly Plus 1PM/shellyplus1pm.status.wifi.status,,"regex","^(got ip)$")=0'
              name: 'Shelly Plus 1PM: WiFi connection is down'
              event_name: 'Shelly Plus 1PM: WiFi connection is down (Status: {ITEM.LASTVALUE})'
              priority: AVERAGE
        - uuid: ec35a5790f0f40d483e1099edc8f1ca9
          name: 'WiFi SSID'
          type: DEPENDENT
          key: shellyplus1pm.status.wifi.ssid
          delay: '0'
          description: 'Connected WiFi network SSID'
          value_type: TEXT
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.wifi.ssid
              error_handler: ZABBIX_DEFAULT
              error_handler_params: 'Unknown'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: wifi
        - uuid: fd35a5790f0f40d483e1099edc8f1caa
          name: 'WiFi RSSI'
          type: DEPENDENT
          key: shellyplus1pm.status.wifi.rssi
          delay: '0'
          description: 'WiFi signal strength in dBm'
          value_type: FLOAT
          units: dBm
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.wifi.rssi
              error_handler: ZABBIX_DEFAULT
              error_handler_params: '-100'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: wifi
          triggers:
            - uuid: 0e35a5790f0f40d483e1099edc8f1cab
              expression: 'last(/Shelly Plus 1PM/shellyplus1pm.status.wifi.rssi)<-80'
              name: 'Shelly Plus 1PM: WiFi signal is weak'
              event_name: 'Shelly Plus 1PM: WiFi signal is weak ({ITEM.LASTVALUE} dBm)'
              priority: WARNING
        - uuid: 1f35a5790f0f40d483e1099edc8f1cac
          name: 'Websocket connection state'
          type: DEPENDENT
          key: shellyplus1pm.status.ws.connected
          delay: '0'
          description: 'Current state of websocket connection'
          valuemap:
            name: 'Boolean (false/true)'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.ws.connected
              error_handler: ZABBIX_DEFAULT
              error_handler_params: 'false'
          master_item:
            key: shellyplus1pm.status
          tags:
            - tag: component
              value: websocket
      triggers:
        - uuid: 2035a5790f0f40d483e1099edc8f1cad
          expression: 'nodata(/Shelly Plus 1PM/shellyplus1pm.status,180s)=1'
          name: 'Shelly Plus 1PM: No data received for >3m'
          event_name: 'Shelly Plus 1PM: No data received for >3m'
          priority: WARNING
          manual_close: 'YES'
      macros:
        - macro: '{$SHELLYPWD}'
          value: '****'
          description: 'Password for admin user, if present'
          type: SECRET_TEXT
        - macro: '{$SHELLYPWD_USER}'
          value: admin
          description: 'Username for admin user'
      valuemaps:
        - uuid: 3135a5790f0f40d483e1099edc8f1cae
          name: 'Boolean (false/true)'
          mappings:
            - value: '0'
              newvalue: 'false'
            - value: '1'
              newvalue: 'true'