zabbix_export:
  version: '7.0'
  template_groups:
  - uuid: f6e5a67c58ea4ca2b31955bf61a344df
    name: Templates/IOT
  templates:
  - uuid: 04cf9fab831f4a4a932f05c0c1fc8e79
    template: Shelly Plus 1PM Gen2
    name: Shelly Plus 1PM Gen2
    description: 'Monitor Shelly Plus 1PM Gen2 smart switch with power monitoring.


      This template monitors the Shelly Plus 1PM device via HTTP using the Gen2 RPC
      API.

      No additional software installation required - the template uses HTTP agent
      items.


      Requirements:

      - Shelly Plus 1PM Gen2 device

      - HTTP access to the device

      - Valid credentials if authentication is enabled


      Template Author: Community Template

      '
    vendor:
      name: Allterco Robotics
      version: 7.0.0
    groups:
    - name: Templates/IOT
    items:
    - uuid: b9dcb9b52f624728b995a46e5557469f
      name: Status gatherer
      type: HTTP_AGENT
      key: shellyplus1pm.status
      delay: '{$POLLING_INTERVAL}'
      description: This gatherer gathers all the data for the different items from
        the RPC API of the Shelly Plus 1PM device.
      value_type: TEXT
      timeout: 15s
      url: http://{HOST.CONN}/rpc/Shelly.GetStatus
      headers:
      - name: User-Agent
        value: Zabbix
      follow_redirects: 'YES'
      retrieve_mode: BODY
      request_method: GET
      allow_traps: 'NO'
      username: '{$SHELLYPWD_USER}'
      password: '{$SHELLYPWD}'
      authtype: DIGEST
      tags:
      - tag: component
        value: raw
      triggers:
      - uuid: 2035a5790f0f40d483e1099edc8f1cad
        expression: nodata(/Shelly Plus 1PM/shellyplus1pm.status,180s)=1
        name: 'Shelly Plus 1PM: No data received for >3m'
        event_name: 'Shelly Plus 1PM: No data received for >3m'
        priority: WARNING
        manual_close: 'YES'
    - uuid: a8cede24ac594ef387c2160e2da7f040
      name: Cloud connection state
      type: DEPENDENT
      key: shellyplus1pm.status.cloud.connected
      delay: '0'
      description: Current state of cloud connection
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.cloud.connected
        error_handler: CUSTOM_VALUE
        error_handler_params: 'false'
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: cloud
      triggers:
      - uuid: 9d35a5790f0f40d483e1099edc8f1c84
        expression: change(/Shelly Plus 1PM/shellyplus1pm.status.cloud.connected)<>0
        name: 'Shelly Plus 1PM: Cloud connection state has changed'
        event_name: 'Shelly Plus 1PM: Cloud connection state has changed'
        priority: WARNING
        manual_close: 'YES'
    - uuid: a74d6817def84e739d2659008f230453
      name: Input state
      type: DEPENDENT
      key: shellyplus1pm.status.input0.state
      delay: '0'
      description: Current state of input 0
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.["input:0"].state
        error_handler: CUSTOM_VALUE
        error_handler_params: 'false'
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: input
      triggers:
      - uuid: bd35a5790f0f40d483e1099edc8f1c86
        expression: change(/Shelly Plus 1PM/shellyplus1pm.status.input0.state)<>0
        name: 'Shelly Plus 1PM: Input state has changed'
        event_name: 'Shelly Plus 1PM: Input state has changed'
        priority: INFO
        manual_close: 'YES'
    - uuid: 92c07b5b29e8485b97d185aef5fc7d68
      name: MQTT connection state
      type: DEPENDENT
      key: shellyplus1pm.status.mqtt.connected
      delay: '0'
      description: Current state of MQTT connection
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.mqtt.connected
        error_handler: CUSTOM_VALUE
        error_handler_params: 'false'
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: mqtt
      triggers:
      - uuid: dd35a5790f0f40d483e1099edc8f1c88
        expression: change(/Shelly Plus 1PM/shellyplus1pm.status.mqtt.connected)<>0
        name: 'Shelly Plus 1PM: MQTT connection state has changed'
        event_name: 'Shelly Plus 1PM: MQTT connection state has changed'
        priority: WARNING
        manual_close: 'YES'
    - uuid: 909069b7e62e4bd6a2c6cff2ea5847a1
      name: Switch output state
      type: DEPENDENT
      key: shellyplus1pm.status.switch0.output
      delay: '0'
      description: Current output state of switch 0
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.["switch:0"].output
        error_handler: CUSTOM_VALUE
        error_handler_params: 'false'
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: switch
      triggers:
      - uuid: fd35a5790f0f40d483e1099edc8f1c8a
        expression: change(/Shelly Plus 1PM/shellyplus1pm.status.switch0.output)<>0
        name: 'Shelly Plus 1PM: Switch state has changed'
        event_name: 'Shelly Plus 1PM: Switch state has changed'
        priority: WARNING
        manual_close: 'YES'
    - uuid: 16169d3266334251b1ff3c46058596cb
      name: Switch command source
      type: DEPENDENT
      key: shellyplus1pm.status.switch0.source
      delay: '0'
      description: Last source of switch command
      value_type: TEXT
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.["switch:0"].source
        error_handler: CUSTOM_VALUE
        error_handler_params: init
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: switch
    - uuid: f8b3b209a08d445f9d0f248a18d91c86
      name: Current power consumption
      type: DEPENDENT
      key: shellyplus1pm.status.switch0.apower
      delay: '0'
      description: Active power being consumed (Watts)
      value_type: FLOAT
      units: W
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.["switch:0"].apower
        error_handler: CUSTOM_VALUE
        error_handler_params: '0'
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: power
    - uuid: 5f9ef49e81734a9a8d085ab1b38a0cf0
      name: Current voltage
      type: DEPENDENT
      key: shellyplus1pm.status.switch0.voltage
      delay: '0'
      description: AC voltage (Volts)
      value_type: FLOAT
      units: V
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.["switch:0"].voltage
        error_handler: CUSTOM_VALUE
        error_handler_params: '0'
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: power
    - uuid: 2d5bc5cf077145319abdd8c3303f589d
      name: Current amperage
      type: DEPENDENT
      key: shellyplus1pm.status.switch0.current
      delay: '0'
      description: Current being drawn (Amperes)
      value_type: FLOAT
      units: A
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.["switch:0"].current
        error_handler: CUSTOM_VALUE
        error_handler_params: '0'
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: power
    - uuid: 6a9d1d1990274f15ae119157ed5f4107
      name: Total energy consumed
      type: DEPENDENT
      key: shellyplus1pm.status.switch0.aenergy.total
      delay: '0'
      description: Total energy consumed (Watt-hours)
      value_type: FLOAT
      units: Wh
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.["switch:0"].aenergy.total
        error_handler: CUSTOM_VALUE
        error_handler_params: '0'
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: energy
    - uuid: 1d6bdc9de16349fda4f8c8d053671cb6
      name: Energy consumption (1 min avg)
      type: DEPENDENT
      key: shellyplus1pm.status.switch0.aenergy.by_minute.0
      delay: '0'
      description: Energy consumption for current minute (Watt-minutes)
      value_type: FLOAT
      units: Wmin
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.["switch:0"].aenergy.by_minute[0]
        error_handler: CUSTOM_VALUE
        error_handler_params: '0'
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: energy
    - uuid: 530fceeebafd4be5b2a5487c79074a23
      name: "Device temperature (\xB0C)"
      type: DEPENDENT
      key: shellyplus1pm.status.switch0.temperature.tC
      delay: '0'
      description: Internal device temperature in Celsius
      value_type: FLOAT
      units: "\xB0C"
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.["switch:0"].temperature.tC
        error_handler: CUSTOM_VALUE
        error_handler_params: '0'
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: temperature
      triggers:
      - uuid: a835a5790f0f40d483e1099edc8f1c95
        expression: last(/Shelly Plus 1PM/shellyplus1pm.status.switch0.temperature.tC)>70
        name: 'Shelly Plus 1PM: Device temperature is high'
        event_name: "Shelly Plus 1PM: Device temperature is high ({ITEM.LASTVALUE}\xB0\
          C)"
        priority: AVERAGE
      - uuid: b935a5790f0f40d483e1099edc8f1c96
        expression: last(/Shelly Plus 1PM/shellyplus1pm.status.switch0.temperature.tC)>85
        name: 'Shelly Plus 1PM: Device temperature is very high'
        event_name: "Shelly Plus 1PM: Device temperature is very high ({ITEM.LASTVALUE}\xB0\
          C)"
        priority: HIGH
    - uuid: a79e14397ea9467db78d697f73850009
      name: MAC address
      type: DEPENDENT
      key: shellyplus1pm.status.sys.mac
      delay: '0'
      description: Device MAC address
      value_type: TEXT
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.sys.mac
        error_handler: CUSTOM_VALUE
        error_handler_params: Unknown
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: system
    - uuid: af251d45e36a4f168aa6f0ec383cc892
      name: Uptime
      type: DEPENDENT
      key: shellyplus1pm.status.sys.uptime
      delay: '0'
      description: Device uptime in seconds
      value_type: FLOAT
      units: uptime
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.sys.uptime
        error_handler: CUSTOM_VALUE
        error_handler_params: '0'
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: system
      triggers:
      - uuid: 4235a5790f0f40d483e1099edc8f1c9f
        expression: last(/Shelly Plus 1PM/shellyplus1pm.status.sys.uptime)<600
        name: 'Shelly Plus 1PM: Device has been restarted (Uptime <10m)'
        event_name: 'Shelly Plus 1PM: Device has been restarted (Uptime <10m)'
        priority: WARNING
    - uuid: 8b69c8db11314495a5abcd4c5a03e2ee
      name: RAM size
      type: DEPENDENT
      key: shellyplus1pm.status.sys.ram_size
      delay: '0'
      description: Total RAM size in bytes
      value_type: FLOAT
      units: B
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.sys.ram_size
        error_handler: CUSTOM_VALUE
        error_handler_params: '0'
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: memory
    - uuid: 4fece459200640f8a746a0afc3c11b70
      name: RAM free
      type: DEPENDENT
      key: shellyplus1pm.status.sys.ram_free
      delay: '0'
      description: Free RAM in bytes
      value_type: FLOAT
      units: B
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.sys.ram_free
        error_handler: CUSTOM_VALUE
        error_handler_params: '0'
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: memory
    - uuid: 5eab9d1d17fc404293a20ea25a0567e7
      name: Filesystem size
      type: DEPENDENT
      key: shellyplus1pm.status.sys.fs_size
      delay: '0'
      description: Total filesystem size in bytes
      value_type: FLOAT
      units: B
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.sys.fs_size
        error_handler: CUSTOM_VALUE
        error_handler_params: '0'
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: filesystem
    - uuid: 1e901e3ab45c4dfb9279071d6a4c2310
      name: Filesystem free
      type: DEPENDENT
      key: shellyplus1pm.status.sys.fs_free
      delay: '0'
      description: Free filesystem space in bytes
      value_type: FLOAT
      units: B
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.sys.fs_free
        error_handler: CUSTOM_VALUE
        error_handler_params: '0'
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: filesystem
      triggers:
      - uuid: 9735a5790f0f40d483e1099edc8f1ca4
        expression: (last(/Shelly Plus 1PM/shellyplus1pm.status.sys.fs_free)/last(/Shelly
          Plus 1PM/shellyplus1pm.status.sys.fs_size))<0.2
        name: 'Shelly Plus 1PM: Filesystem usage >=80%'
        event_name: 'Shelly Plus 1PM: Filesystem usage >=80%'
        priority: WARNING
      - uuid: a835a5790f0f40d483e1099edc8f1ca5
        expression: (last(/Shelly Plus 1PM/shellyplus1pm.status.sys.fs_free)/last(/Shelly
          Plus 1PM/shellyplus1pm.status.sys.fs_size))<0.1
        name: 'Shelly Plus 1PM: Filesystem usage >=90%'
        event_name: 'Shelly Plus 1PM: Filesystem usage >=90%'
        priority: AVERAGE
    - uuid: 5dd969bf5f734d8181ae7669c88ee0ae
      name: WiFi IP address
      type: DEPENDENT
      key: shellyplus1pm.status.wifi.sta_ip
      delay: '0'
      description: Current WiFi IP address
      value_type: TEXT
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.wifi.sta_ip
        error_handler: CUSTOM_VALUE
        error_handler_params: Unknown
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: wifi
    - uuid: 4f7db06fcd254619a25ea7e9075cd8e7
      name: WiFi status
      type: DEPENDENT
      key: shellyplus1pm.status.wifi.status
      delay: '0'
      description: Current WiFi connection status
      value_type: TEXT
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.wifi.status
        error_handler: CUSTOM_VALUE
        error_handler_params: Unknown
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: wifi
      triggers:
      - uuid: db35a5790f0f40d483e1099edc8f1ca8
        expression: find(/Shelly Plus 1PM/shellyplus1pm.status.wifi.status,,"regex","^(got
          ip)$")=0
        name: 'Shelly Plus 1PM: WiFi connection is down'
        event_name: 'Shelly Plus 1PM: WiFi connection is down (Status: {ITEM.LASTVALUE})'
        priority: AVERAGE
    - uuid: c2ef0b27b78e491c8bbf6e8f004dca69
      name: WiFi SSID
      type: DEPENDENT
      key: shellyplus1pm.status.wifi.ssid
      delay: '0'
      description: Connected WiFi network SSID
      value_type: TEXT
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.wifi.ssid
        error_handler: CUSTOM_VALUE
        error_handler_params: Unknown
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: wifi
    - uuid: 56d2e4ff1f0a4228911e06627ede19ec
      name: WiFi RSSI
      type: DEPENDENT
      key: shellyplus1pm.status.wifi.rssi
      delay: '0'
      description: WiFi signal strength in dBm
      value_type: FLOAT
      units: dBm
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.wifi.rssi
        error_handler: CUSTOM_VALUE
        error_handler_params: '-100'
      master_item:
        key: shellyplus1pm.status
      tags:
      - tag: component
        value: wifi
      triggers:
      - uuid: 0e35a5790f0f40d483e1099edc8f1cab
        expression: last(/Shelly Plus 1PM/shellyplus1pm.status.wifi.rssi)<-80
        name: 'Shelly Plus 1PM: WiFi signal is weak'
        event_name: 'Shelly Plus 1PM: WiFi signal is weak ({ITEM.LASTVALUE} dBm)'
        priority: WARNING
    - uuid: b581ceb6094d4ac490606bd1b463cdd3
      name: Firmware update check
      type: HTTP_AGENT
      key: shellyplus1pm.firmware.check
      delay: 12h
      description: Check for available firmware updates
      value_type: TEXT
      timeout: 15s
      url: http://{HOST.CONN}/rpc/Shelly.CheckForUpdate
      headers:
      - name: User-Agent
        value: Zabbix
      follow_redirects: 'YES'
      retrieve_mode: BODY
      request_method: GET
      allow_traps: 'NO'
      username: '{$SHELLYPWD_USER}'
      password: '{$SHELLYPWD}'
      authtype: DIGEST
      tags:
      - tag: component
        value: firmware
    - uuid: 6b5996b1d176419aa761640d49d32818
      name: Stable firmware available
      type: DEPENDENT
      key: shellyplus1pm.firmware.stable.available
      delay: '0'
      description: Whether a stable firmware update is available
      value_type: FLOAT
      preprocessing:
      - type: JAVASCRIPT
        parameters:
        - 'var data = JSON.parse(value); return (data.stable && data.stable.version)
          ? 1 : 0;'
      master_item:
        key: shellyplus1pm.firmware.check
      tags:
      - tag: component
        value: firmware
    - uuid: 4bc9920421b14af4a0318e045fc23c6e
      name: Stable firmware version available
      type: DEPENDENT
      key: shellyplus1pm.firmware.stable.version
      delay: '0'
      description: Version number of available stable firmware
      value_type: TEXT
      preprocessing:
      - type: JAVASCRIPT
        parameters:
        - 'var data = JSON.parse(value); return (data.stable && data.stable.version)
          ? data.stable.version : "No stable update available";'
      master_item:
        key: shellyplus1pm.firmware.check
      tags:
      - tag: component
        value: firmware
    - uuid: 30eccf8bf5fd41a8b9da85b415232850
      name: Device info gatherer
      type: HTTP_AGENT
      key: shellyplus1pm.deviceinfo
      delay: '{$POLLING_INTERVAL}'
      description: Get device information including current firmware version
      value_type: TEXT
      timeout: 15s
      url: http://{HOST.CONN}/rpc/Shelly.GetDeviceInfo
      headers:
      - name: User-Agent
        value: Zabbix
      follow_redirects: 'YES'
      retrieve_mode: BODY
      request_method: GET
      allow_traps: 'NO'
      username: '{$SHELLYPWD_USER}'
      password: '{$SHELLYPWD}'
      authtype: DIGEST
      tags:
      - tag: component
        value: firmware
    - uuid: 0dbeb7fc66a1421788693ebeb225f064
      name: Current firmware version
      type: DEPENDENT
      key: shellyplus1pm.firmware.current.version
      delay: '0'
      description: Currently installed firmware version
      value_type: TEXT
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.fw_id
        error_handler: CUSTOM_VALUE
        error_handler_params: Unknown
      master_item:
        key: shellyplus1pm.deviceinfo
      tags:
      - tag: component
        value: firmware
    macros:
    - macro: '{$SHELLYPWD}'
      value: '****'
      description: Password for admin user, if present
      type: SECRET_TEXT
    - macro: '{$SHELLYPWD_USER}'
      value: admin
      description: Username for admin user
    - macro: '{$POLLING_INTERVAL}'
      value: 60s
      description: 'How often to poll device status (default: 60 seconds)'
    valuemaps:
    - uuid: ca9306c04a7e41ccae77160125b5359e
      name: Boolean (false/true)
      mappings:
      - value: '0'
        newvalue: 'false'
      - value: '1'
        newvalue: 'true'
