# ==============================================================================
# APC PowerChute Business Edition (PCBE) Zabbix Template
# ==============================================================================
# Author: arch3rek https://arch3r.eu
# Created: August 23, 2025
# Version: 1.0
# Compatible with: Zabbix 7.x
# 
# Description:
# This template monitors APC PCBE UPS systems via SNMPv3
# 
# Monitored parameters:
# - Input voltage and frequency
# - Output voltage, load, current and frequency  
# - Battery capacity and runtime
# - Internal temperature
# - Output status (with text mapping)
#
# Configurable thresholds via macros:
# - Input voltage range (203-253V)
# - Output load warning (80%)
# - Battery capacity low (20%)
# - Temperature high (40°C)
#
# Usage:
# 1. Import this template to Zabbix
# 2. Create host with SNMP interface
# 3. Configure SNMPv3 credentials
# 4. Link this template to the host
# 5. Adjust macro values if needed
#
# Repository: https://github.com/arch3rek/zabbix-apc-pcbe-template
# License: MIT
# ============================================================================== 

zabbix_export:
  version: '7.0'
  templates:
    - uuid: '12345678123442348234123456789abc'
      template: 'APC_PCBE_by_SNMP_v3'
      name: 'APC PCBE by SNMP (v3)'
      groups:
        - name: 'Templates/Power'
      macros:
        - macro: '{$PCBE_INPUT_VOLT_MIN}'
          value: '203'
        - macro: '{$PCBE_INPUT_VOLT_MAX}'
          value: '253'
        - macro: '{$PCBE_OUTPUT_LOAD_WARN}'
          value: '80'
        - macro: '{$PCBE_BATTERY_CAP_LOW}'
          value: '20'
        - macro: '{$PCBE_TEMP_HIGH}'
          value: '40'
      items:
        - uuid: '12345678123442348234123456789ab1'
          name: 'Input voltage (adv)'
          type: SNMP_AGENT
          snmp_oid: '1.3.6.1.4.1.318.1.1.1.3.2.1.0'
          key: 'pcbe.input.voltage'
          delay: '1m'
          value_type: FLOAT
          units: 'V'
        - uuid: '12345678123442348234123456789ab2'
          name: 'Input frequency (adv)'
          type: SNMP_AGENT
          snmp_oid: '1.3.6.1.4.1.318.1.1.1.3.2.4.0'
          key: 'pcbe.input.freq'
          delay: '1m'
          value_type: FLOAT
          units: 'Hz'
        - uuid: '12345678123442348234123456789ab3'
          name: 'Output voltage (adv)'
          type: SNMP_AGENT
          snmp_oid: '1.3.6.1.4.1.318.1.1.1.4.2.1.0'
          key: 'pcbe.output.voltage'
          delay: '1m'
          value_type: FLOAT
          units: 'V'
        - uuid: '12345678123442348234123456789ab4'
          name: 'Output load (adv)'
          type: SNMP_AGENT
          snmp_oid: '1.3.6.1.4.1.318.1.1.1.4.2.6.0'
          key: 'pcbe.output.load'
          delay: '1m'
          value_type: FLOAT
          units: '%'
        - uuid: '12345678123442348234123456789ab5'
          name: 'Battery capacity'
          type: SNMP_AGENT
          snmp_oid: '1.3.6.1.4.1.318.1.1.1.2.2.1.0'
          key: 'pcbe.battery.capacity'
          delay: '1m'
          value_type: UNSIGNED
          units: '%'
        - uuid: '12345678123442348234123456789ab6'
          name: 'Battery runtime remaining'
          type: SNMP_AGENT
          snmp_oid: '1.3.6.1.4.1.318.1.1.1.2.2.3.0'
          key: 'pcbe.battery.runtime'
          delay: '1m'
          value_type: UNSIGNED
          units: 's'
        - uuid: '12345678123442348234123456789ab7'
          name: 'Output status (basic)'
          type: SNMP_AGENT
          snmp_oid: '1.3.6.1.4.1.318.1.1.1.4.1.1.0'
          key: 'pcbe.output.status'
          delay: '1m'
          value_type: UNSIGNED
          valuemap:
            name: 'APC Output Status'
        - uuid: '12345678123442348234123456789ab9'
          name: 'Internal temperature'
          type: SNMP_AGENT
          snmp_oid: '1.3.6.1.4.1.318.1.1.1.2.2.2.0'
          key: 'pcbe.internal.temperature'
          delay: '1m'
          value_type: FLOAT
          units: '°C'
        - uuid: '12345678123442348234123456789aba'
          name: 'Output current'
          type: SNMP_AGENT
          snmp_oid: '1.3.6.1.4.1.318.1.1.1.4.2.4.0'
          key: 'pcbe.output.current'
          delay: '1m'
          value_type: FLOAT
          units: 'A'
        - uuid: '12345678123442348234123456789abb'
          name: 'Output frequency'
          type: SNMP_AGENT
          snmp_oid: '1.3.6.1.4.1.318.1.1.1.4.2.2.0'
          key: 'pcbe.output.frequency'
          delay: '1m'
          value_type: FLOAT
          units: 'Hz'
      valuemaps:
        - uuid: '12345678123442348234123456789ab8'
          name: 'APC Output Status'
          mappings:
            - value: '1'
              newvalue: 'unknown'
            - value: '2'
              newvalue: 'onLine'
            - value: '3'
              newvalue: 'onBattery'
            - value: '4'
              newvalue: 'onSmartBoost'
            - value: '5'
              newvalue: 'timedSleeping'
            - value: '6'
              newvalue: 'softwareBypass'
            - value: '7'
              newvalue: 'off'
            - value: '8'
              newvalue: 'rebooting'
            - value: '9'
              newvalue: 'switchedBypass'
            - value: '10'
              newvalue: 'hwFailureBypass'
            - value: '11'
              newvalue: 'sleepUntilPowerReturn'
