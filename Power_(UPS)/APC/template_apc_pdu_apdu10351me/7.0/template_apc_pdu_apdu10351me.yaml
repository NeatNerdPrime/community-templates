zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: 52f4e9aa580b40488a239ed1d9e0030a
      name: Templates

  templates:
    - uuid: d6ba82d75f1849a1bdc511260806d83c
      template: 'APC PDU APDU10351ME'
      name: 'APC PDU APDU10351ME'
      description: |
        APC rack PDU monitoring (3-phase) using APC cPDU MIB v1.8.
        Applications: Phases, Thresholds, Information.
      groups:
        - name: Templates

      macros:
        - macro: '{$SNMP_COMMUNITY}'
          value: public

      valuemaps:
        - uuid: 82c8ca86646444b792113044de1c551e
          name: 'APC Status Load State'
          mappings:
            - { value: '1', newvalue: lowLoad }
            - { value: '2', newvalue: normal }
            - { value: '3', newvalue: nearOverload }
            - { value: '4', newvalue: overload }

      items:
        # ---- Phase thresholds (Amps, hundredths) ----
        # Lower (warning) -> leaf 5
        - uuid: 51a35dff1386426d88923dfe82622afb
          name: 'Phase 1 Low Load Threshold'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.318.1.1.32.3.2.1.5.1.1
          key: rPDULoadPhaseConfigLowLoadThreshold.1
          delay: 12h
          history: 30d
          value_type: FLOAT
          units: A
          preprocessing:
            - { type: MULTIPLIER, parameters: ['0.01'] }
          tags: [ { tag: Application, value: Thresholds } ]

        - uuid: cbc0263220bc4fd3b5d1ca9634ca9196
          name: 'Phase 2 Low Load Threshold'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.318.1.1.32.3.2.1.5.1.2
          key: rPDULoadPhaseConfigLowLoadThreshold.2
          delay: 12h
          history: 30d
          value_type: FLOAT
          units: A
          preprocessing:
            - { type: MULTIPLIER, parameters: ['0.01'] }
          tags: [ { tag: Application, value: Thresholds } ]

        - uuid: 954df6e20f2d4e79b1886c9fd2121071
          name: 'Phase 3 Low Load Threshold'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.318.1.1.32.3.2.1.5.1.3
          key: rPDULoadPhaseConfigLowLoadThreshold.3
          delay: 12h
          history: 30d
          value_type: FLOAT
          units: A
          preprocessing:
            - { type: MULTIPLIER, parameters: ['0.01'] }
          tags: [ { tag: Application, value: Thresholds } ]

        # Near overload (upper warning) -> leaf 7
        - uuid: ffa6ae903e4f445199bbc7a53136552d
          name: 'Phase 1 Near Overload Threshold'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.318.1.1.32.3.2.1.7.1.1
          key: rPDULoadPhaseConfigNearOverloadThreshold.1
          delay: 12h
          history: 30d
          value_type: FLOAT
          units: A
          preprocessing:
            - { type: MULTIPLIER, parameters: ['0.01'] }
          tags: [ { tag: Application, value: Thresholds } ]

        - uuid: 6580d9b8a3094b4c88dcf57f38061dea
          name: 'Phase 2 Near Overload Threshold'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.318.1.1.32.3.2.1.7.1.2
          key: rPDULoadPhaseConfigNearOverloadThreshold.2
          delay: 12h
          history: 30d
          value_type: FLOAT
          units: A
          preprocessing:
            - { type: MULTIPLIER, parameters: ['0.01'] }
          tags: [ { tag: Application, value: Thresholds } ]

        - uuid: 4f26c118825f430895968d05372e6978
          name: 'Phase 3 Near Overload Threshold'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.318.1.1.32.3.2.1.7.1.3
          key: rPDULoadPhaseConfigNearOverloadThreshold.3
          delay: 12h
          history: 30d
          value_type: FLOAT
          units: A
          preprocessing:
            - { type: MULTIPLIER, parameters: ['0.01'] }
          tags: [ { tag: Application, value: Thresholds } ]

        # Overload (upper critical) -> leaf 6
        - uuid: 03fc08060a1c4bdb8a5b97f290ff9a8e
          name: 'Phase 1 Overload Threshold'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.318.1.1.32.3.2.1.6.1.1
          key: rPDULoadPhaseConfigOverloadThreshold.1
          delay: 12h
          history: 30d
          value_type: FLOAT
          units: A
          preprocessing:
            - { type: MULTIPLIER, parameters: ['0.01'] }
          tags: [ { tag: Application, value: Thresholds } ]

        - uuid: b292cdc4651b472c86493d284f0c2663
          name: 'Phase 2 Overload Threshold'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.318.1.1.32.3.2.1.6.1.2
          key: rPDULoadPhaseConfigOverloadThreshold.2
          delay: 12h
          history: 30d
          value_type: FLOAT
          units: A
          preprocessing:
            - { type: MULTIPLIER, parameters: ['0.01'] }
          tags: [ { tag: Application, value: Thresholds } ]

        - uuid: 0e93cf5ffc6649bc8ff8a57c75e5d828
          name: 'Phase 3 Overload Threshold'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.318.1.1.32.3.2.1.6.1.3
          key: rPDULoadPhaseConfigOverloadThreshold.3
          delay: 12h
          history: 30d
          value_type: FLOAT
          units: A
          preprocessing:
            - { type: MULTIPLIER, parameters: ['0.01'] }
          tags: [ { tag: Application, value: Thresholds } ]

        # ---- Phase loads (Amps, hundredths) ----
        # pduInputPhaseStatusCurrent -> leaf 5
        - uuid: 09feb099e2b64cf589cec59b0ec7f9a4
          name: 'Phase 1 Load'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.318.1.1.32.3.4.1.5.1.1
          key: rPDULoadStatusLoad.1
          delay: 30s
          history: 30d
          value_type: FLOAT
          units: A
          preprocessing:
            - { type: MULTIPLIER, parameters: ['0.01'] }
          tags: [ { tag: Application, value: Phases } ]

        - uuid: 3e958990ef554c3da6cb57cc2385c3f1
          name: 'Phase 2 Load'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.318.1.1.32.3.4.1.5.1.2
          key: rPDULoadStatusLoad.2
          delay: 30s
          history: 30d
          value_type: FLOAT
          units: A
          preprocessing:
            - { type: MULTIPLIER, parameters: ['0.01'] }
          tags: [ { tag: Application, value: Phases } ]

        - uuid: 54f936b996e143998b446a0a66679164
          name: 'Phase 3 Load'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.318.1.1.32.3.4.1.5.1.3
          key: rPDULoadStatusLoad.3
          delay: 30s
          history: 30d
          value_type: FLOAT
          units: A
          preprocessing:
            - { type: MULTIPLIER, parameters: ['0.01'] }
          tags: [ { tag: Application, value: Phases } ]

      dashboards:
        - uuid: 1470684bde3f4f95bca5915d38a8914b
          name: 'APC Phase Status'
          pages:
            - widgets: []

  triggers:
    - uuid: 5b01578bc6c5492ebb4db92e7d427fe2
      name: 'E: Phase 1 Near Overload ({ITEM.LASTVALUE1} A)'
      priority: HIGH
      expression: 'avg(/APC PDU APDU10351ME/rPDULoadStatusLoad.1,#2) > last(/APC PDU APDU10351ME/rPDULoadPhaseConfigNearOverloadThreshold.1)'

    - uuid: 4b12985a2d8b44d58c8d3457a5fd1df1
      name: 'E: Phase 2 Near Overload ({ITEM.LASTVALUE1} A)'
      priority: HIGH
      expression: 'avg(/APC PDU APDU10351ME/rPDULoadStatusLoad.2,#2) > last(/APC PDU APDU10351ME/rPDULoadPhaseConfigNearOverloadThreshold.2)'

    - uuid: db6e434c31a74de9b994d84c6ea82bf5
      name: 'E: Phase 3 Near Overload ({ITEM.LASTVALUE1} A)'
      priority: HIGH
      expression: 'avg(/APC PDU APDU10351ME/rPDULoadStatusLoad.3,#2) > last(/APC PDU APDU10351ME/rPDULoadPhaseConfigNearOverloadThreshold.3)'

    - uuid: 1f7e49e8626f4fd29d9c3cd8ed4e5a65
      name: 'F: Phase 1 Overload ({ITEM.LASTVALUE1} A)'
      priority: DISASTER
      expression: 'avg(/APC PDU APDU10351ME/rPDULoadStatusLoad.1,#2) > last(/APC PDU APDU10351ME/rPDULoadPhaseConfigOverloadThreshold.1)'

    - uuid: 527eeb78298f4371882771a25340f128
      name: 'F: Phase 2 Overload ({ITEM.LASTVALUE1} A)'
      priority: DISASTER
      expression: 'avg(/APC PDU APDU10351ME/rPDULoadStatusLoad.2,#2) > last(/APC PDU APDU10351ME/rPDULoadPhaseConfigOverloadThreshold.2)'

    - uuid: ee0060fb47f44ebc86ab395a35d389f9
      name: 'F: Phase 3 Overload ({ITEM.LASTVALUE1} A)'
      priority: DISASTER
      expression: 'avg(/APC PDU APDU10351ME/rPDULoadStatusLoad.3,#2) > last(/APC PDU APDU10351ME/rPDULoadPhaseConfigOverloadThreshold.3)'

    - uuid: 370658d6b9fb4521b062c5680415832c
      name: 'I: No load: Phase 1 ({ITEM.LASTVALUE1} A)'
      priority: INFO
      expression: 'avg(/APC PDU APDU10351ME/rPDULoadStatusLoad.1,#2) < last(/APC PDU APDU10351ME/rPDULoadPhaseConfigLowLoadThreshold.1)'

    - uuid: a244dc635f0a43d196feb6e5f065b32c
      name: 'I: No load: Phase 2 ({ITEM.LASTVALUE1} A)'
      priority: INFO
      expression: 'avg(/APC PDU APDU10351ME/rPDULoadStatusLoad.2,#2) < last(/APC PDU APDU10351ME/rPDULoadPhaseConfigLowLoadThreshold.2)'

    - uuid: fa19535c0fb548c19ad521aaa3024183
      name: 'I: No load: Phase 3 ({ITEM.LASTVALUE1} A)'
      priority: INFO
      expression: 'avg(/APC PDU APDU10351ME/rPDULoadStatusLoad.3,#2) < last(/APC PDU APDU10351ME/rPDULoadPhaseConfigLowLoadThreshold.3)'

  graphs:
    - uuid: 8857dd8964e740c880b40e9f3286023f
      name: 'APC Current Usage'
      type: STACKED
      show_legend: 'YES'
      graph_items:
        - color: 3333FF
          item:
            host: 'APC PDU APDU10351ME'
            key: rPDULoadStatusLoad.3
        - sortorder: '1'
          color: 33FFFF
          item:
            host: 'APC PDU APDU10351ME'
            key: rPDULoadStatusLoad.2
        - sortorder: '2'
          color: 33FF33
          item:
            host: 'APC PDU APDU10351ME'
            key: rPDULoadStatusLoad.1
